import{t as e,z as l,v as a,aO as s,aS as t,_ as r,d as i,b as o,r as d,c as n,L as u,J as m,I as p,g as c,f,e as b,l as v,k as g,i as y,w as _,D as w,E as k,n as j,q as h,S as V,o as x,m as P,aT as z,C,aU as E,$ as U,F as S,ap as q,h as A,aC as I}from"./index.ZLNrSxa7.js";import{E as F}from"./el-dialog.B32-6Hy6.js";import"./el-overlay.TtYSBS3d.js";import{a as Z,E as $}from"./el-form-item.CSlDAgNu.js";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang.BrN4ykYs.js";import{E as B}from"./el-input.DEr4JItJ.js";import{E as N,a as O}from"./el-tab-pane.ClYdxeRm.js";import{E as R,a as T}from"./el-col.C7kZ-_eW.js";import{E as J}from"./el-card.DbBDXnab.js";import{E as L,a as D}from"./el-descriptions-item.CDHFiNQP.js";import{E as Q}from"./el-button.DSrO3PCY.js";import{F as W}from"./index.DeD-8QMH.js";import{_ as X}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.CAmgOVMc.js";import"./refs.CwYjimeG.js";import"./index.D_Z5gYVY.js";import"./vnode.BzFWtM5t.js";import"./index.C7eagngv.js";import"./error.CmW-dgG_.js";import"./scroll.CuImcdyA.js";import"./use-form-common-props.C1EZqqFQ.js";import"./el-popper.B221JJYw.js";import"./castArray.BeWz_jd2.js";import"./_Uint8Array.DXkM4Snb.js";import"./el-checkbox.BmPwdX9L.js";import"./isEqual.DHfRWznk.js";import"./el-radio-group.L_l3Yw1E.js";/* empty css                 *//* empty css               */import"./el-select.35Upkc1v.js";import"./el-scrollbar.ET7HVX21.js";import"./index.CjPWYcvS.js";import"./token.DWNpOE8r.js";import"./strings.C35vyqlw.js";import"./index.BQb3_wVy.js";import"./_baseIteratee.Bs4VfSlC.js";import"./index.Cqrz8MS-.js";import"./index.BnUUwnwX.js";import"./index.CnUlAD1Y.js";const G=e({size:{type:[Number,String],values:t,default:"",validator:e=>s(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:a},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:l(String),default:"cover"}}),H={error:e=>e instanceof Event},K=i({name:"ElAvatar"});const Y=h(r(i({...K,props:G,emits:H,setup(e,{emit:l}){const a=e,t=o("avatar"),r=d(!1),i=n((()=>{const{size:e,icon:l,shape:s}=a,r=[t.b()];return u(e)&&r.push(t.m(e)),l&&r.push(t.m("icon")),s&&r.push(t.m(s)),r})),h=n((()=>{const{size:e}=a;return s(e)?t.cssVarBlock({size:m(e)||""}):void 0})),V=n((()=>({objectFit:a.fit})));function x(e){r.value=!0,l("error",e)}return p((()=>a.src),(()=>r.value=!1)),(e,l)=>(f(),c("span",{class:j(y(i)),style:g(y(h))},[!e.src&&!e.srcSet||r.value?e.icon?(f(),b(y(k),{key:1},{default:_((()=>[(f(),b(w(e.icon)))])),_:1})):v(e.$slots,"default",{key:2}):(f(),c("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:g(y(V)),onError:x},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ee={class:"app-container"},le={class:"w-full"},ae={class:"relative w-100px h-100px flex-center"},se={class:"mt-5"},te={class:"text-14px mt-2"},re={class:"mt-5"},ie={class:"text-14px mt-2"},oe={key:0},de={key:1},ne={class:"mt-5"},ue={class:"text-14px mt-2"},me={key:0},pe={key:1},ce={class:"dialog-footer"},fe=X(i({__name:"index",setup(e){const l=d({}),a=V({visible:!1,title:"",type:""}),s=V({}),t=V({}),r=V({}),i=V({}),o=d(0),n=d(),u=d(0),m=d(),p={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},v={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},g={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},w=e=>{switch(a.type=e,a.visible=!0,e){case"account":a.title="账号资料",s.id=l.value.id,s.nickname=l.value.nickname,s.gender=l.value.gender;break;case"password":a.title="修改密码";break;case"mobile":a.title="绑定手机";break;case"email":a.title="绑定邮箱"}};function j(){if(!r.mobile)return void I.error("请输入手机号");/^1[3-9]\d{9}$/.test(r.mobile)?z.sendMobileCode(r.mobile).then((()=>{I.success("验证码发送成功"),o.value=60,n.value=setInterval((()=>{o.value>0?o.value-=1:clearInterval(n.value)}),1e3)})):I.error("手机号格式不正确")}function h(){if(!i.email)return void I.error("请输入邮箱");/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(i.email)?z.sendEmailCode(i.email).then((()=>{I.success("验证码发送成功"),u.value=60,m.value=setInterval((()=>{u.value>0?u.value-=1:clearInterval(m.value)}),1e3)})):I.error("邮箱格式不正确")}const X=async()=>{if("account"===a.type)z.updateProfile(s).then((()=>{I.success("账号资料修改成功"),a.visible=!1,fe()}));else if("password"===a.type){if(t.newPassword!==t.confirmPassword)return void I.error("两次输入的密码不一致");z.changePassword(t).then((()=>{I.success("密码修改成功"),a.visible=!1}))}else"mobile"===a.type?z.bindOrChangeMobile(r).then((()=>{I.success("手机号绑定成功"),a.visible=!1,fe()})):"email"===a.type&&z.bindOrChangeEmail(i).then((()=>{I.success("邮箱绑定成功"),a.visible=!1,fe()}))},G=d(null),H=()=>{var e;null==(e=G.value)||e.click()},K=async e=>{const a=e.target,s=a.files?a.files[0]:null;if(s)try{const e=await W.uploadFile(s);l.value.avatar=e.url,await z.updateProfile({avatar:e.url})}catch(t){I.error("头像上传失败")}},fe=async()=>{const e=await z.getProfile();l.value=e};return x((async()=>{n.value&&clearInterval(n.value),m.value&&clearInterval(m.value),await fe()})),(e,d)=>{const n=Y,m=Q,V=q("Edit"),x=k,z=q("User"),I=q("Male"),W=q("Female"),fe=D,be=q("Phone"),ve=q("Message"),ge=q("Timer"),ye=L,_e=J,we=O,ke=T,je=R,he=N,Ve=B,xe=Z,Pe=M,ze=$,Ce=F;return f(),c("div",ee,[P(he,{"tab-position":"left"},{default:_((()=>[P(we,{label:"账号信息"},{default:_((()=>[C("div",le,[P(_e,null,{default:_((()=>[C("div",ae,[P(n,{src:y(l).avatar,size:100},null,8,["src"]),P(m,{type:"info",class:"absolute bottom-0 right-0 cursor-pointer",circle:"",icon:y(E),size:"small",onClick:H},null,8,["icon"]),C("input",{ref_key:"fileInput",ref:G,type:"file",style:{display:"none"},onChange:K},null,544)]),C("div",se,[U(S(y(l).nickname)+" ",1),P(x,{class:"align-middle cursor-pointer",onClick:d[0]||(d[0]=e=>w("account"))},{default:_((()=>[P(V)])),_:1})]),P(ye,{column:1,class:"mt-10"},{default:_((()=>[P(fe,null,{label:_((()=>[P(x,{class:"align-middle"},{default:_((()=>[P(z)])),_:1}),d[17]||(d[17]=U(" 用户名 "))])),default:_((()=>[U(" "+S(y(l).username)+" ",1),1===y(l).gender?(f(),b(x,{key:0,class:"align-middle color-blue"},{default:_((()=>[P(I)])),_:1})):(f(),b(x,{key:1,class:"align-middle color-pink"},{default:_((()=>[P(W)])),_:1}))])),_:1}),P(fe,null,{label:_((()=>[P(x,{class:"align-middle"},{default:_((()=>[P(be)])),_:1}),d[18]||(d[18]=U(" 手机号码 "))])),default:_((()=>[U(" "+S(y(l).mobile),1)])),_:1}),P(fe,null,{label:_((()=>[P(x,{class:"align-middle"},{default:_((()=>[P(ve)])),_:1}),d[19]||(d[19]=U(" 邮箱 "))])),default:_((()=>[U(" "+S(y(l).email),1)])),_:1}),P(fe,null,{label:_((()=>d[20]||(d[20]=[C("div",{class:"i-svg:tree"},null,-1),U(" 部门 ")]))),default:_((()=>[U(" "+S(y(l).deptName),1)])),_:1}),P(fe,null,{label:_((()=>d[21]||(d[21]=[C("div",{class:"i-svg:role"},null,-1),U(" 角色 ")]))),default:_((()=>[U(" "+S(y(l).roleNames),1)])),_:1}),P(fe,null,{label:_((()=>[P(x,{class:"align-middle"},{default:_((()=>[P(ge)])),_:1}),d[22]||(d[22]=U(" 创建日期 "))])),default:_((()=>[U(" "+S(y(l).createTime),1)])),_:1})])),_:1})])),_:1})])])),_:1}),P(we,{label:"安全设置"},{default:_((()=>[P(_e,null,{default:_((()=>[P(je,null,{default:_((()=>[P(ke,{span:16},{default:_((()=>[d[25]||(d[25]=C("div",{class:"font-bold"},"账户密码",-1)),C("div",te,[d[24]||(d[24]=U(" 定期修改密码有助于保护账户安全 ")),P(m,{type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[1]||(d[1]=()=>w("password"))},{default:_((()=>d[23]||(d[23]=[U(" 修改 ")]))),_:1})])])),_:1})])),_:1}),C("div",re,[d[28]||(d[28]=C("div",{class:"font-bold"},"绑定手机",-1)),C("div",ie,[y(l).mobile?(f(),c("span",oe,"已绑定手机号："+S(y(l).mobile),1)):(f(),c("span",de,"未绑定手机")),y(l).mobile?(f(),b(m,{key:2,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[2]||(d[2]=()=>w("mobile"))},{default:_((()=>d[26]||(d[26]=[U(" 更换 ")]))),_:1})):(f(),b(m,{key:3,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[3]||(d[3]=()=>w("mobile"))},{default:_((()=>d[27]||(d[27]=[U(" 绑定 ")]))),_:1}))])]),C("div",ne,[d[31]||(d[31]=C("div",{class:"font-bold"},"绑定邮箱",-1)),C("div",ue,[y(l).email?(f(),c("span",me,"已绑定邮箱："+S(y(l).email),1)):(f(),c("span",pe,"未绑定邮箱")),y(l).email?(f(),b(m,{key:2,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[4]||(d[4]=()=>w("email"))},{default:_((()=>d[29]||(d[29]=[U(" 更换 ")]))),_:1})):(f(),b(m,{key:3,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[5]||(d[5]=()=>w("email"))},{default:_((()=>d[30]||(d[30]=[U(" 绑定 ")]))),_:1}))])])])),_:1})])),_:1})])),_:1}),P(Ce,{modelValue:y(a).visible,"onUpdate:modelValue":d[16]||(d[16]=e=>y(a).visible=e),title:y(a).title,width:500},{footer:_((()=>[C("span",ce,[P(m,{onClick:d[15]||(d[15]=e=>y(a).visible=!1)},{default:_((()=>d[32]||(d[32]=[U("取消")]))),_:1}),P(m,{type:"primary",onClick:X},{default:_((()=>d[33]||(d[33]=[U("确定")]))),_:1})])])),default:_((()=>["account"===y(a).type?(f(),b(ze,{key:0,ref:"userProfileFormRef",model:y(s),"label-width":100},{default:_((()=>[P(xe,{label:"昵称"},{default:_((()=>[P(Ve,{modelValue:y(s).nickname,"onUpdate:modelValue":d[6]||(d[6]=e=>y(s).nickname=e)},null,8,["modelValue"])])),_:1}),P(xe,{label:"性别"},{default:_((()=>[P(Pe,{modelValue:y(s).gender,"onUpdate:modelValue":d[7]||(d[7]=e=>y(s).gender=e),code:"gender"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0),"password"===y(a).type?(f(),b(ze,{key:1,ref:"passwordChangeFormRef",model:y(t),rules:p,"label-width":100},{default:_((()=>[P(xe,{label:"原密码",prop:"oldPassword"},{default:_((()=>[P(Ve,{modelValue:y(t).oldPassword,"onUpdate:modelValue":d[8]||(d[8]=e=>y(t).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),P(xe,{label:"新密码",prop:"newPassword"},{default:_((()=>[P(Ve,{modelValue:y(t).newPassword,"onUpdate:modelValue":d[9]||(d[9]=e=>y(t).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),P(xe,{label:"确认密码",prop:"confirmPassword"},{default:_((()=>[P(Ve,{modelValue:y(t).confirmPassword,"onUpdate:modelValue":d[10]||(d[10]=e=>y(t).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):"mobile"===y(a).type?(f(),b(ze,{key:2,ref:"mobileBindingFormRef",model:y(r),rules:v,"label-width":100},{default:_((()=>[P(xe,{label:"手机号码",prop:"mobile"},{default:_((()=>[P(Ve,{modelValue:y(r).mobile,"onUpdate:modelValue":d[11]||(d[11]=e=>y(r).mobile=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),P(xe,{label:"验证码",prop:"code"},{default:_((()=>[P(Ve,{modelValue:y(r).code,"onUpdate:modelValue":d[12]||(d[12]=e=>y(r).code=e),style:{width:"250px"}},{append:_((()=>[P(m,{class:"ml-5",disabled:y(o)>0,onClick:j},{default:_((()=>[U(S(y(o)>0?`${y(o)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):"email"===y(a).type?(f(),b(ze,{key:3,ref:"emailBindingFormRef",model:y(i),rules:g,"label-width":100},{default:_((()=>[P(xe,{label:"邮箱",prop:"email"},{default:_((()=>[P(Ve,{modelValue:y(i).email,"onUpdate:modelValue":d[13]||(d[13]=e=>y(i).email=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),P(xe,{label:"验证码",prop:"code"},{default:_((()=>[P(Ve,{modelValue:y(i).code,"onUpdate:modelValue":d[14]||(d[14]=e=>y(i).code=e),style:{width:"250px"}},{append:_((()=>[P(m,{class:"ml-5",disabled:y(u)>0,onClick:h},{default:_((()=>[U(S(y(u)>0?`${y(u)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-28ab2a0c"]]);export{fe as default};
